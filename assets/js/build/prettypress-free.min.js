function prettypress(a){if(void 0===a)throw new Error("prettypress() called without any config json passed as argument 1.");this.config=a,this.config.selectorElements={},populateElements=function(){for(var a in this.config.elements)this.config.elements[a].element=document.getElementById(this.config.elements[a].id)},createErrorBox=function(a,b){var c=document.createElement("div");c.className="prettypress_errorbox";var d=document.createElement("h3");d.innerHTML=a;var e=document.createElement("div");e.className="description",e.innerHTML=b;var f=document.createElement("a");f.className="close",f.innerHTML="Got it",c.appendChild(d),c.appendChild(e),c.appendChild(f),jQuery(f).on("click",function(){jQuery(c).fadeTo(250,0,function(){c.parentNode.removeChild(c)})}),this.config.elements.external.element.appendChild(c),jQuery(c).fadeTo(250,1)},launchPrettyPress=function(){return this.config.postActive===!1?(this.createErrorBox("No draft visible.","<p>Sorry, you need to enter a post title and save it as a draft before\n				 PrettyPress can launch it's editor.</p>"),!1):(this.syncWpEditors(),void jQuery(this.config.elements.wrapper.element).fadeIn(500,function(){prettypressHandleResize()}))},syncWpEditors=function(){var a=this.getActiveWpEditorContent(),b=this.config.elements.wpTitle.element.value;a=this.reverseFilter(this.config.activeEditor,a);var c=!1,d=null;switch(this.config.activeEditor){case"markdown":a!==this.config.elements.markdown.element.value&&(c=!0,d=this.config.elements.markdown.element);break;case"html":a!==this.config.elements.html.element.value&&(c=!0,d=this.config.elements.html.element);break;case"visual":a!==this.getVisualValue()&&(c=!0,d="visual")}c===!0&&("visual"!==d?d.value=a:this.setVisualValue(a)),b!==window.config.elements.title.element.value&&(window.config.elements.title.element.value=b)},getVisualValue=function(){var a=null;return a=window.tinymce.get(this.config.elements.tinymce.id).getContent()},setVisualValue=function(a){window.tinymce.get(this.config.elements.tinymce.id).setContent(a)},getActiveWpEditorContent=function(){var a=!1;if(jQuery("#wp-content-wrap").hasClass("tmce-active")&&(a=!0),a===!0)return tinymce.get("content").getContent();var b=document.getElementById("content");return this.wpautop(b.value)},wpautop=function(a){return a+="\n",a=a.replace(/(\r\n|\n|\r)/g,"<br />")},closePrettyPress=function(){jQuery(this.config.elements.wrapper.element).fadeOut(500)},tryFillContent=function(){if(this.config.postContentPP)var a=this.decodeContent(this.config.postContentPP);else{var a=this.decodeContent(this.config.postContent);a=this.reverseFilter(this.config.activeEditor,a)}switch(this.config.activeEditor){case"markdown":this.config.elements.markdown.element.value=a;break;case"html":this.config.elements.html.element.value=a;break;case"visual":this.setVisualValue(a)}},reverseFilter=function(a,b){switch(a){case"markdown":return this.htmlToMarkdown(b);case"html":return html_beautify(b);case"visual":return b}return b},decodeContent=function(a){return Base64.decode(a)},liveUpdate=function(a,b){var c=this.config.elements.iframe.element;switch(a){case"title":jQuery(this.config.selectors.title,jQuery(c).contents()).html(b),this.updateWpTitle(b);break;case"markdown":b=this.markdownToHtml(b);var d=b;"function"==typeof prettypressProActive&&(b=prettypressFilterShortcodes(b),b=prettypressFilteroEmbeds(b)),jQuery(this.config.selectors.content,jQuery(c).contents()).html(b),this.updateWpEditor("content",d);break;case"html":var d=b;"function"==typeof prettypressProActive&&(b=prettypressFilterShortcodes(b),b=prettypressFilteroEmbeds(b)),jQuery(this.config.selectors.content,jQuery(c).contents()).html(b),this.updateWpEditor("content",d);break;case"visual":var d=b;"function"==typeof prettypressProActive&&(b=prettypressFilterShortcodes(b),b=prettypressFilteroEmbeds(b)),jQuery(this.config.selectors.content,jQuery(c).contents()).html(b),this.updateWpEditor("content",d)}},updateWpTitle=function(a){this.config.elements.wpTitle.element.value=a},updateWpEditor=function(a,b){switch(a){case"content":var c=document.getElementById("content");tinymce.hasOwnProperty("activeEditor")&&null!==tinymce.get("content")?(tinymce.get("content").setContent(b),c.value=b):c.value=b}},toggleMenu=function(){jQuery(this.config.elements.menu.element).hasClass("prettypress_menu_active")?(jQuery(this.config.elements.menuTrigger.element).removeClass("prettypress_menuTrigger_active"),jQuery(this.config.elements.menu.element).removeClass("prettypress_menu_active")):(jQuery(this.config.elements.menuTrigger.element).addClass("prettypress_menuTrigger_active"),jQuery(this.config.elements.menu.element).addClass("prettypress_menu_active"))},updatePost=function(){var a=this;window.setTimeout(function(){jQuery(a.config.elements.publish.element).click()},500),this.closePrettyPress()},parseShortcodes=function(a){return a},markdownToHtml=function(a){return marked(a)},htmlToMarkdown=function(a){return toMarkdown(a)},syncPPEditors=function(){var a=this.getRawPPContent();switch(this.config.activeEditor){case"markdown":a=this.markdownToHtml(a),this.config.elements.html.element.value=html_beautify(a),this.setVisualValue(a);break;case"html":markdownContent=this.htmlToMarkdown(a),this.config.elements.markdown.element.value=markdownContent,this.setVisualValue(a);break;case"visual":markdownContent=this.htmlToMarkdown(a),this.config.elements.markdown.element.value=markdownContent,this.config.elements.html.element.value=html_beautify(a)}},getRawPPContent=function(){switch(this.config.activeEditor){case"markdown":return this.config.elements.markdown.element.value;case"html":return this.config.elements.html.element.value;case"visual":return this.getVisualValue()}},switchTabs=function(a,b,c){return this.config.activeEditor===a?!1:(this.syncPPEditors(),jQuery(".prettypress_tab_active").removeClass("prettypress_tab_active"),jQuery("#"+b).addClass("prettypress_tab_active"),jQuery("#prettypress_tabs .active").removeClass("active"),jQuery(c).addClass("active"),void(this.config.activeEditor=a))},executeHooks=function(){var a=this;this.config.elements.trig.element.onclick=function(b){b.preventDefault(),a.launchPrettyPress()},this.config.elements.close.element.onclick=function(b){b.preventDefault(),a.closePrettyPress()},this.config.elements.menuTrigger.element.onclick=function(b){b.preventDefault(),a.toggleMenu()},this.config.elements.update.element.onclick=function(b){b.preventDefault(),a.updatePost()},this.config.elements.title.element.onkeyup=function(b){a.liveUpdate("title",this.value)},this.config.elements.markdown.element.onkeyup=function(b){a.liveUpdate("markdown",this.value)},this.config.elements.html.element.onkeyup=function(b){a.liveUpdate("html",this.value)},this.config.elements.proLink.element.onclick=function(a){a.preventDefault();var b=window.open(this.href,"_blank");b.focus()},tinymce.get(this.config.elements.tinymce.id).onKeyUp.add(function(b,c){a.liveUpdate("visual",a.getVisualValue())}),jQuery("[data-click=activateTab]").on("click",function(b){if(b.preventDefault(),!jQuery(this).hasClass("active")){var c=jQuery(this).attr("data-rel"),d=jQuery(this).attr("data-val");a.switchTabs(d,c,this)}}),jQuery("[data-rel=prettypress_preview_size]").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("data-size");prettypressResizePre(b)})},window.onload=function(){this.populateElements(),this.tryFillContent(),this.executeHooks()}}